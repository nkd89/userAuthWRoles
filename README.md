# Самый обычный и пустой проект, создан, чтобы потом не мучаться с созданием пользователей и регой токенов jwt, также есть проверка доступа по роли

## .env

```
# Основные настройки

PORT=

# База данных

DB_HOST=
DB_PORT=
DB_USERNAME=
DB_PASSWORD=
DB_NAME=

# JWT

JWT_SECRET=
```

## PermissionGuard

`PermissionGuard` — это кастомный guard в NestJS, который проверяет, есть ли у пользователя необходимые разрешения для доступа к определённому маршруту. Он использует метаданные, определённые с помощью декораторов, для выполнения проверки разрешений.

### Основные возможности:

- Проверяет разрешения пользователя на соответствие необходимым (все или хотя бы одно).
- Получает данные пользователя и его роли из базы данных.
- Выбрасывает исключение `ForbiddenException`, если доступ запрещён.

### Использование:

1. Определите необходимые разрешения с помощью кастомных декораторов (`PERMISSIONS_ALL_KEY` или `PERMISSIONS_ANY_KEY`).
2. Примените `PermissionGuard` к маршруту или контроллеру.

### Пример:

```typescript
@UseGuards(JwtAuthGuard, PermissionGuard)
@PermissionsAll('user:write') // Нужны все разрешения перечисленные в декораторе
@PermissionsAny('user:write') // Нужно хотя бы одно разрешение перечисленное в декораторе
@Get('protected-route')
async protectedRoute() {
  return 'Этот маршрут защищён разрешениями';
}
```

---

## JWT Декоратор

JWT-декоратор извлекает объект `user` из полезной нагрузки JWT и делает его доступным в запросе.

### Использование:

```typescript
@(JwtAuthGuard) // не пускает без jwt токена
@Get('profile')
async getProfile(@Request() req) {
  const userId = req.user.id; // достаем полезную нагрузку
  return `ID пользователя: ${userId}`;
}
```

Этот декоратор упрощает доступ к данным аутентифицированного пользователя в ваших контроллерах.
