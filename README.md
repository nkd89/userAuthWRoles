# –°–∞–º—ã–π –æ–±—ã—á–Ω—ã–π –∏ –ø—É—Å—Ç–æ–π –ø—Ä–æ–µ–∫—Ç, —Å–æ–∑–¥–∞–Ω, —á—Ç–æ–±—ã –ø–æ—Ç–æ–º –Ω–µ –º—É—á–∞—Ç—å—Å—è —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–µ–≥–æ–π —Ç–æ–∫–µ–Ω–æ–≤ jwt, —Ç–∞–∫–∂–µ –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø–æ —Ä–æ–ª–∏

## .env

```
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

PORT=

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

DB_HOST=
DB_PORT=
DB_USERNAME=
DB_PASSWORD=
DB_NAME=

# JWT

JWT_SECRET=
```

## PermissionGuard

`PermissionGuard` ‚Äî —ç—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–π guard –≤ NestJS, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º—É –º–∞—Ä—à—Ä—É—Ç—É. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤, –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º (–≤—Å–µ –∏–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ).
- –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ —Ä–æ–ª–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
- –í—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ `ForbiddenException`, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ (`PERMISSIONS_ALL_KEY` –∏–ª–∏ `PERMISSIONS_ANY_KEY`).
2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ `PermissionGuard` –∫ –º–∞—Ä—à—Ä—É—Ç—É –∏–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É.

### –ü—Ä–∏–º–µ—Ä:

```typescript
@UseGuards(JwtAuthGuard, PermissionGuard)
@PermissionsAll('user:write') // –ù—É–∂–Ω—ã –≤—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–µ
@PermissionsAny('user:write') // –ù—É–∂–Ω–æ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω–æ–µ –≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–µ
@Get('protected-route')
async protectedRoute() {
  return '–≠—Ç–æ—Ç –º–∞—Ä—à—Ä—É—Ç –∑–∞—â–∏—â—ë–Ω —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏';
}
```

---

## JWT –î–µ–∫–æ—Ä–∞—Ç–æ—Ä

JWT-–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –∏–∑–≤–ª–µ–∫–∞–µ—Ç –æ–±—ä–µ–∫—Ç `user` –∏–∑ –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ JWT –∏ –¥–µ–ª–∞–µ—Ç –µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤ –∑–∞–ø—Ä–æ—Å–µ.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```typescript
@(JwtAuthGuard) // –Ω–µ –ø—É—Å–∫–∞–µ—Ç –±–µ–∑ jwt —Ç–æ–∫–µ–Ω–∞
@Get('profile')
async getProfile(@Request() req) {
  const userId = req.user.id; // –¥–æ—Å—Ç–∞–µ–º –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É
  return `ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${userId}`;
}
```

–≠—Ç–æ—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä —É–ø—Ä–æ—â–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≤–∞—à–∏—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö.

---



## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–µ—Ç–æ–∫ (Git flow)

* `main` ‚Äî –ø—Ä–æ–¥–∞–∫—à–µ–Ω. –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥.
* `dev` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –≤–µ—Ç–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.
* `feature/–Ω–∞–∑–≤–∞–Ω–∏–µ` ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏.
* `hotfix/–Ω–∞–∑–≤–∞–Ω–∏–µ` ‚Äî —Å—Ä–æ—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞.
* `release/x.y.z` ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –≤—ã–ø—É—Å–∫—É.

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞

### üßπ Prettier

* –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ (–æ—Ç—Å—Ç—É–ø—ã, –ø—Ä–æ–±–µ–ª—ã, –∑–∞–ø—è—Ç—ã–µ –∏ —Ç.–ø.)
* –ê–≤—Ç–æ—Ñ–∏–∫—Å –≤–æ–∑–º–æ–∂–µ–Ω

npm run format       # –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç
npm run format:write # –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å

### üö® ESLint

* –õ–∏–Ω—Ç–µ—Ä TypeScript-–∫–æ–¥–∞
* –û—Ç–∫–ª—é—á–µ–Ω—ã —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ —ç—Ç–∞–ø–µ MVP

npm run lint       # –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏
npm run lint:fix   # –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### üîê Husky + lint-staged

* **–î–æ –∫–æ–º–º–∏—Ç–∞** :
* –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ —Ñ–æ—Ä–º–∞—Ç –∏ —Å—Ç–∏–ª—å
* –ü—Ä–æ–≤–µ—Ä–∫–∞ commit-—Å–æ–æ–±—â–µ–Ω–∏—è (Conventional Commits)

#### –ü—Ä–∏–º–µ—Ä—ã –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∫–æ–º–º–∏—Ç–æ–≤:

feat(auth): add JWT login
fix(users): fix bug with auth
refactor(core): refactor logging

> ‚ùå –ö–æ–º–º–∏—Ç—ã –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ (`"bad message"`) ‚Äî **–±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è**

---

## ‚úÖ CI/CD —á–µ—Ä–µ–∑ GitHub Actions

–ü–∞–π–ø–ª–∞–π–Ω—ã:

### `.github/workflows/ci.yml`

* –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ª—é–±–æ–º –ø—É—à–µ –∏–ª–∏ PR
* –ü—Ä–æ–≤–µ—Ä—è–µ—Ç:
  * –õ–∏–Ω—Ç
  * –°–±–æ—Ä–∫—É

### `.github/workflows/deploy.yml`

* –ê–≤—Ç–æ-–¥–µ–ø–ª–æ–π:
  * –∏–∑ `main` ‚Üí –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

üîê –ù–µ –∑–∞–±—É–¥—å –∑–∞–¥–∞—Ç—å `secrets` –≤ GitHub:

* `HOST`, `USER`, `SSH_KEY`, `PORT`

---


## üö® –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∫–æ–º–º–∏—Ç–∞–º

–ü—Ä–∏–Ω—è—Ç—ã–π —Å—Ç–∏–ª—å ‚Äî  **Conventional Commits** : `<type>`(`<scope>`): –æ–ø–∏—Å–∞–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä—ã —Ç–∏–ø–æ–≤:

| –¢–∏–ø       | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                          |
| ------------ | ------------------------------------------------------------- |
| `feat`     | –ù–æ–≤–∞—è —Ñ–∏—á–∞                                           |
| `fix`      | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–∞                               |
| `refactor` | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ |
| `test`     | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ |
| `docs`     | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏                 |
| `chore`    | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, —Å–±–æ—Ä–∫–∞   |

---

## üîÑ –¢–∏–ø–æ–≤–æ–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞

1. `git checkout dev`
2. `git pull`
3. `git checkout -b feature/login-form`
4. –†–∞–±–æ—Ç–∞–µ—à—å, –∫–æ–º–º–∏—Ç–∏—à—å (`npm run lint`, `git commit`)
5. `git push -u origin feature/login-form`
6. –û—Ç–∫—Ä—ã–≤–∞–µ—à—å Pull Request ‚Üí `dev`
7. CI –ø—Ä–æ–≤–µ—Ä—è–µ—Ç (–ª–∏–Ω—Ç, —Ç–µ—Å—Ç—ã, —Å–±–æ—Ä–∫–∞)
8. –†–µ–≤—å—é ‚Üí –º–µ—Ä–∂ –≤ `dev`
9. –ü–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ ‚Äî –º–µ—Ä–∂ `dev` ‚Üí `main` —á–µ—Ä–µ–∑ `release/x.y.z`

---

## üìå –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

* `.husky/pre-commit`: –Ω–µ –¥–∞—ë—Ç –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –≥—Ä—è–∑–Ω—ã–π –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
* `.husky/commit-msg`: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –∫–æ–º–º–∏—Ç–∞
* `.prettierrc`, `.editorconfig` ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Å—Ç–∏–ª—è –¥–ª—è –≤—Å–µ–π –∫–æ–º–∞–Ω–¥—ã
